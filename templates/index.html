<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>DomGen Hosting Service</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: Arial, sans-serif; background: #f8f9fa; color: #333; }

    header {
      background: #4CAF50; color: white; padding: 15px; text-align: center;
      font-size: 22px; font-weight: bold;
    }

    .container { max-width: 900px; margin: 20px auto; padding: 20px; }

    .card {
      background: white; border-radius: 8px; padding: 20px; margin-bottom: 20px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
    }

    h2 { margin-bottom: 15px; font-size: 20px; color: #4CAF50; }
    input, button, select, textarea {
      padding: 10px; margin: 8px 0; width: 100%;
      border: 1px solid #ccc; border-radius: 5px; font-size: 14px;
    }
    button { background: #4CAF50; color: white; cursor: pointer; font-weight: bold; }
    button:hover { background: #45a049; }

    .hidden { display: none; }
    .msg { margin-top: 10px; padding: 10px; border-radius: 5px; }
    .msg.success { background: #d4edda; color: #155724; }
    .msg.error { background: #f8d7da; color: #721c24; }

    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background: #f2f2f2; }

    .fixed-footer {
      position: fixed; bottom: 0; width: 100%;
      background: #4CAF50; color: white; text-align: center; padding: 10px;
    }
    .fixed-footer a { color: white; text-decoration: underline; }
  </style>
</head>
<body>
  <header>üåê DomGen Hosting Service</header>

  <div class="container">

    <!-- LOGIN -->
    <div id="login-section" class="card">
      <h2>Login</h2>
      <input type="text" id="login-username" placeholder="Username">
      <input type="password" id="login-password" placeholder="Password">
      <button onclick="login()">Login</button>
      <p>New here? <a href="#" onclick="showCreate()">Create Account</a></p>
      <div id="login-msg" class="msg"></div>
    </div>

    <!-- CREATE ACCOUNT -->
    <div id="create-section" class="card hidden">
      <h2>Create Account</h2>
      <input type="text" id="create-username" placeholder="Choose Username">
      <input type="password" id="create-password" placeholder="Choose Password">
      <button onclick="createAccount()">Create</button>
      <p>Already registered? <a href="#" onclick="showLogin()">Login</a></p>
      <div id="create-msg" class="msg"></div>
    </div>

    <!-- DASHBOARD -->
    <div id="dashboard" class="hidden">
      <div class="card">
        <h2>Welcome, <span id="user-display"></span></h2>
        <p id="uses-info"></p>
      </div>

      <!-- Hosting -->
      <div class="card">
        <h2>Host a Website</h2>
        <form id="upload-form">
          <input type="text" id="site-name" placeholder="Site Name" required>
          <input type="file" id="site-file" accept=".zip">
          <button type="submit">Upload</button>
        </form>
        <textarea id="html-editor" placeholder="Or paste HTML here..." rows="6"></textarea>
        <button onclick="uploadFromText()">Upload from Text</button>
        <div id="upload-msg" class="msg"></div>
      </div>

      <!-- Redeem -->
      <div class="card">
        <h2>Redeem Code</h2>
        <input type="text" id="redeem-code" placeholder="Enter Redeem Code">
        <button onclick="redeemCode()">Redeem</button>
        <div id="redeem-msg" class="msg"></div>
      </div>

      <!-- Admin -->
      <div id="admin-section" class="card hidden">
        <h2>Admin Dashboard</h2>
        
        <h3>Generate Redeem Code</h3>
        <input type="number" id="slots" placeholder="Number of uses for code">
        <button onclick="generateCode()">Generate</button>
        <div id="code-msg" class="msg"></div>

        <h3>All Codes</h3>
        <table id="codes-table">
          <thead><tr><th>Code</th><th>Slots</th><th>Used By</th></tr></thead>
          <tbody></tbody>
        </table>

        <h3>All Users</h3>
        <table id="users-table">
          <thead><tr><th>Username</th><th>Uses Left</th><th>Admin</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>

  <div class="fixed-footer">
    Need help? <a href="https://chat.whatsapp.com/KA28UYJhcCiHneYVHxcCdk" target="_blank">Contact Admin</a>
  </div>

  <script>
    const API = "https://domgen-hosting.onrender.com"; // backend

    let currentUser = null;
    let isAdmin = false;

    function showCreate() {
      document.getElementById("login-section").classList.add("hidden");
      document.getElementById("create-section").classList.remove("hidden");
    }

    function showLogin() {
      document.getElementById("create-section").classList.add("hidden");
      document.getElementById("login-section").classList.remove("hidden");
    }

    async function createAccount() {
      const username = document.getElementById("create-username").value;
      const password = document.getElementById("create-password").value;

      try {
        const res = await fetch(`${API}/create_user`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ username, password })
        });
        const data = await res.json();
        if (res.ok) {
          showMsg("create-msg", "‚úÖ Account created! Now login.");
        } else {
          showMsg("create-msg", data.error, true);
        }
      } catch {
        showMsg("create-msg", "‚ùå Server error", true);
      }
    }

    async function login() {
      const username = document.getElementById("login-username").value;
      const password = document.getElementById("login-password").value;

      try {
        const res = await fetch(`${API}/login_user`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ username, password })
        });
        const data = await res.json();
        if (res.ok) {
          currentUser = data.username;
          isAdmin = data.is_admin;
          document.getElementById("login-section").classList.add("hidden");
          document.getElementById("dashboard").classList.remove("hidden");
          document.getElementById("user-display").textContent = currentUser;
          document.getElementById("uses-info").textContent = isAdmin
            ? "You are an Admin. Unlimited hosting."
            : `Uses Left: ${data.uses_left}`;
          if (isAdmin) loadAdminData();
        } else {
          showMsg("login-msg", data.error, true);
        }
      } catch (err) {
        showMsg("login-msg", "‚ùå Server error", true);
      }
    }

    // Upload from Text
    async function uploadFromText() {
      const siteName = document.getElementById("site-name").value;
      const htmlContent = document.getElementById("html-editor").value;

      if (!siteName || !htmlContent) {
        showMsg("upload-msg", "‚ùå Please enter site name and HTML", true);
        return;
      }

      try {
        const res = await fetch(`${API}/upload_text`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ username: currentUser, site_name: siteName, html_content: htmlContent })
        });
        const data = await res.json();
        if (res.ok) {
          showMsg("upload-msg", `‚úÖ Site hosted at: ${data.url}`);
        } else {
          showMsg("upload-msg", data.error, true);
        }
      } catch {
        showMsg("upload-msg", "‚ùå Upload failed", true);
      }
    }

    // Redeem
    async function redeemCode() {
      const code = document.getElementById("redeem-code").value;
      try {
        const res = await fetch(`${API}/redeem`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ username: currentUser, code })
        });
        const data = await res.json();
        if (res.ok) {
          showMsg("redeem-msg", "‚úÖ Code redeemed successfully!");
          document.getElementById("uses-info").textContent = `Uses Left: ${data.uses_left}`;
        } else {
          showMsg("redeem-msg", data.error, true);
        }
      } catch {
        showMsg("redeem-msg", "‚ùå Redeem failed", true);
      }
    }

    // Generate code (admin)
    async function generateCode() {
      const slots = document.getElementById("slots").value;
      try {
        const res = await fetch(`${API}/generate_code`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ slots })
        });
        const data = await res.json();
        if (res.ok) {
          showMsg("code-msg", `‚úÖ Code generated: ${data.code}`);
          loadAdminData();
        } else {
          showMsg("code-msg", data.error, true);
        }
      } catch {
        showMsg("code-msg", "‚ùå Failed to generate code", true);
      }
    }

    // Load admin data
    async function loadAdminData() {
      try {
        const res = await fetch(`${API}/admin_data`);
        const data = await res.json();

        const codesTable = document.querySelector("#codes-table tbody");
        codesTable.innerHTML = "";
        data.codes.forEach(c => {
          codesTable.innerHTML += `<tr><td>${c.code}</td><td>${c.slots}</td><td>${c.used_by.join(", ")}</td></tr>`;
        });

        const usersTable = document.querySelector("#users-table tbody");
        usersTable.innerHTML = "";
        data.users.forEach(u => {
          usersTable.innerHTML += `<tr><td>${u.username}</td><td>${u.uses_left}</td><td>${u.is_admin}</td></tr>`;
        });

        document.getElementById("admin-section").classList.remove("hidden");
      } catch {
        showMsg("code-msg", "‚ùå Failed to load admin data", true);
      }
    }

    function showMsg(id, text, isError = false) {
      const el = document.getElementById(id);
      el.textContent = text;
      el.className = "msg " + (isError ? "error" : "success");
    }
  </script>
</body>
</html>
